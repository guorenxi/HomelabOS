---
# Configure a TOR hidden service for remote access without a public IP
- name: "Setup TOR"
  hosts: all
  tags: tor
  become: true
  roles:
    - role: tor
      when: enable_tor

## Configure the server itself
#- name: configure HomelabOS
#  hosts: all
#  become: true
#  # gather_facts: "True"
#  tags: common
#  roles:
#    # Install Docker, configure basic server settings
#    - homelabos_common

- name: "Deploy Bastion Host with Wireguard"
  hosts: all
  tags: bastion
  become: true
  tasks:
    - include_role:
        name: homelabos_wireguard
      when: bastion.enable == True

# Install and configure HomelabOS base services
- name: Install and configure HomelabOS base services
  hosts: all
  tags:
    - deploy
  roles:
    - homelabos_api_deploy

  # Install and configure HomelabOS services
- name: Install and configure HomelabOS services
  hosts: all
  tags:
    - deploy_service
  roles:
    - homelabos_api_deploy_service
